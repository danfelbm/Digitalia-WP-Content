/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/sysend@1.17.4/sysend.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**@license
 *  sysend.js - send messages between browser windows/tabs version 1.17.4
 *
 *  Copyright (C) 2014 Jakub T. Jankiewicz <https://jcubic.pl/me>
 *  Released under the MIT license
 *
 *  The idea for localStorage implementation came from this StackOverflow question:
 *  http://stackoverflow.com/q/24182409/387194
 *
 */
!function(n,e){"function"==typeof define&&define.amd?define(["sysend"],e):"object"==typeof exports?module.exports=e():n.sysend=e()}("undefined"!=typeof window?window:this,(function(){var n,e,t,r,o,i,a=!1,c=400,u="___sysend___",s=new RegExp(u,"g"),d=Math.random(),f={},m={},l=[],_=0,p=!1,y=!0,w=!1,h=0,v=0,g=(r=(new Date).getTime(),o=performance&&performance.now&&1e3*performance.now()||0,"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var e=16*Math.random();return r>0?(e=(r+e)%16|0,r=Math.floor(r/16)):(e=(o+e)%16|0,o=Math.floor(o/16)),("x"===n?e:3&e|8).toString(16)}))),x=1,b=0,k={primary:[],close:[],open:[],secondary:[],message:[],visbility:[],ready:[],update:[]},E=Object.keys(k),S=H(f,"to"),L=H(f,"from"),O={id:g,broadcast:function(n,t){return e&&!w?(C("broadcast",{event:n,data:t}),e.postMessage({name:n,data:S(t)})):(!function(n,e){C({set:n,value:e}),0==h&&z().setItem(N(n),d);z().setItem(N(n),e)}(n,function(n){var e=[h++,d];void 0!==n&&e.push(n);var t=S(e);if(t===e)return JSON.stringify(e);return t}(t)),setTimeout((function(){var e;C({remove:e=n}),z().removeItem(N(e))}),0)),function(n,e){l.forEach((function(t){var r={name:u,key:n,data:e};B(T(t.node.src))&&t.window.postMessage(JSON.stringify(r),"*")}))}(n,t),O},emit:function(n,e){return C("emit",{event:n,data:e}),O.broadcast(n,e),D(n,e),O},serializer:function(n,e){if(!R(n)||!R(e))throw new Error("sysend::serializer: Invalid argument, expecting function");return f.to=n,f.from=e,O},proxy:function(...n){return n.forEach((function(n){if(U(n)&&P(n)!==window.location.host){i=i||[];var e=T(n);if(i.includes(e)){var t='iframe[src="'+n+'"]';if(document.querySelector(t))return void M("You already called proxy on "+n+" you only need to call this function once")}i.push(e);var r=document.createElement("iframe");r.style.width=r.style.height=0,r.style.position="absolute",r.style.top=r.style.left="-9999px",r.style.border="none";var o=n;n.match(/\.html|\.php|\?/)||(o=n.replace(/\/$/,"")+"/proxy.html"),r.addEventListener("error",(function e(){setTimeout((function(){throw new Error('html proxy file not found on "'+n+'" url')}),0),r.removeEventListener("error",e)})),r.addEventListener("load",(function n(){var e;try{e=r.contentWindow}catch(n){e=r.contentWindow}l.push({window:e,node:r}),r.removeEventListener("load",n)})),document.body.appendChild(r),r.src=o}})),!arguments.length&&Y&&(p=!0),O},on:function(n,e){return m[n]||(m[n]=[]),m[n].push(e),O},off:function(n,e,t=!1){if(m[n])if(e)for(var r=m[n].length;r--;)m[n][r]==e&&m[n].splice(r,1);else(t&&q(n)||!t)&&(m[n]=[]);return O},track:function(n,e,t=!1){return t&&(e[Symbol.for(u)]=!0),E.includes(n)&&k[n].push(e),O},untrack:function(n,e,t=!1){return E.includes(n)&&k[n].length&&(k[n]=void 0===e?t?[]:k[n].filter((function(n){return!n[Symbol.for(u)]})):k[n].filter((function(n){return n!==e}))),O},post:function(n,e){return O.broadcast(N("__message__"),{target:n,data:e,origin:g})},list:function(){var n=v++,e={target:g,id:n,origin:self.origin},t=j(O.timeout);return new Promise((function(r){var o=[];function i(t){C("__window_ack__",{data:t,marker:e}),t.origin.target===g&&t.origin.id===n&&o.push({id:t.id,primary:t.primary})}O.on(N("__window_ack__"),i),O.broadcast(N("__window__"),{id:e}),t().then((function(){C("timeout",{ids:o}),O.off(N("__window_ack__"),i),r(o)}))}))},channel:function(...n){return i=n.map(T),O},isPrimary:function(){return y},useLocalStorage:function(n){w="boolean"!=typeof n||n},rpc:function(n){var e=++b,t=`__${e}_rpc_request__`,r=`__${e}_rpc_response__`,o=0;O.track("message",(async function({data:e,origin:o}){if(e.type==t){var{method:i,args:a,id:c}=e,u=r;if(Object.hasOwn(n,i))try{!function(n,e,t=null){if(A(n)){var r=n.then(e);return null===t?r:r.catch(t)}e(n)}(n[i](...a),(function(n){O.post(o,{result:n,id:c,type:u})}),(function(n){O.post(o,{error:n.message,id:c,type:u})}))}catch(n){O.post(o,{error:n.message,id:c,type:u})}else O.post(o,{error:"Method not found",id:c,type:u})}}),!0);return Object.fromEntries(Object.keys(n).map((function(n){return[n,function(e,...i){return e?function(n,e,i=[]){var a=++o;return new Promise((function(o,c){O.track("message",(function e({data:t,origin:i}){if(t.type===r){var{result:s,error:d,id:f}=t;i===n&&a===f&&(d?c(d):o(s),clearTimeout(u),O.untrack("message",e))}}),!0),O.post(n,{method:e,id:a,type:t,args:i});var u=setTimeout((function(){c(new Error("Timeout error"))}),1e3)}))}(e,n,i):Promise.reject(new Error("You need to specify the target window/tab"))}]})))}};Object.defineProperty(O,"timeout",{enumerable:!0,get:function(){return c},set:function(n){"number"!=typeof n||isNaN(n)||(c=n)}});var P=function(){if("undefined"!=typeof URL)return function(n){return n?(n=new URL(n)).host:n};var n=document.createElement("a");return function(e){return e?(n.href=e,n.host):e}}();function j(n){return function(){return new Promise((function(e){setTimeout(e,n)}))}}var T=function(){function n(n){return function(e){try{return n(e)}catch(n){return e}}}if(window.URL)return n((function(n){return new URL(n).origin}));var e=document.createElement("a");return n((function(n){return e.href=n,e.origin}))}(),I=[];function M(n){I.includes(n)||(I.push(n),console&&console.warn?console.warn(n):setTimeout((function(){throw new Error(n)}),0))}function C(){a&&console.log.apply(null,[self.origin].concat(Array.from(arguments)))}function N(n){return u+n}function A(n){return n&&"object"==typeof object&&R(object.then)}function R(n){return"function"==typeof n}function U(n){return"string"==typeof n}function q(n){return n.match(s)}function B(n){if(!i)return M("Call sysend.channel() on iframe to restrict domains that can use sysend channel"),!0;var e=i.includes(n);return e||M(n+" domain is not on the list of allowed domains use sysend.channel() on iframe to allow access to this domain"),e}function J(n,...e){n.forEach((function(n){n.apply(null,e)}))}function z(){return t?t.localStorage:localStorage}function H(n,e){var t={from:"Unserialize",to:"Serialize"}[e]+" Error: ";return function(r){var o=n[e];try{return o?o(r):r}catch(n){M(t+n.message)}}}var Y=function(){try{return window.self!==window.top}catch(n){return!0}}(),$=function(){try{return z().setItem(u,1),z().removeItem(u),!1}catch(n){return!0}}();function W(){return Y&&p}function D(n,e){m[n].forEach((function(t){t(e,n)}))}function V(){y=!0,J(k.primary),O.emit(N("__primary__"))}function F(){C("setup_ls()");var n=new RegExp("^"+u),e=z();for(var t in e)t.match(n)&&e.removeItem(t);window.addEventListener("storage",(function(e){if(e.key&&e.key.match(n)&&_++%2==0){var t=e.key.replace(n,"");if(C("__key__",e.key+" ==> "+t,{callbacks:m[t],again:m[t.replace(n,"")]}),m[t]){var r=e.newValue||function(n){return C({get:n}),z().getItem(N(n))}(e.key);if(r&&r!=d){var o=(a=L(i=r))===i?JSON.parse(i):a;o&&o[1]!=d&&D(t,o[2])}}}var i,a}),!1)}function G(){var r,o;t?t.hasOwnProperty("BroadcastChannel")&&(e=new t.BroadcastChannel(u)):e=new window.BroadcastChannel(u),e&&e.addEventListener("message",(function(n){if(n.target.name===u)if(C("message",{data:n.data,iframe:W()}),W()){var e={name:u,data:n.data,iframe_id:g};B(T(document.referrer))&&window.parent.postMessage(JSON.stringify(e),"*")}else{var t=n.data&&n.data.name;m[t]&&D(t,L(n.data.data))}})),$||F(),W()?window.addEventListener("message",(function(n){if(function(n){return U(n.data)&&q(n.data)}(n)&&B(n.origin))try{var e=JSON.parse(n.data);if(C("iframe",e,e.name===u),e&&e.name===u){var t=L(e.data);O.broadcast(e.key,t)}}catch(n){}})):(void 0!==document.hidden?(r="hidden",o="visibilitychange"):void 0!==document.msHidden?(r="msHidden",o="msvisibilitychange"):void 0!==document.webkitHidden&&(r="webkitHidden",o="webkitvisibilitychange"),R(document.addEventListener)&&r&&document.addEventListener(o,(function(){J(k.visbility,!document[r])}),!1),O.track("visbility",(function(e){e&&!n&&V()}),!0),O.on(N("__primary__"),(function(){C("__primary__"),n=!0})),O.on(N("__open__"),(function(n){C("__open__",n);var e=n.id;x++,y&&O.broadcast(N("__ack__")),J(k.open,{count:x,primary:n.primary,id:n.id}),e===g&&J(k.ready)})),O.on(N("__ack__"),(function(){y||J(k.secondary)})),O.on(N("__close__"),(function(e){C("__close__",e);var t=1===--x;e.wasPrimary&&!y&&(n=!1);var r={id:e.id,count:x,primary:e.wasPrimary,self:e.id===g};t&&V(),J(k.close,r)})),O.on(N("__window__"),(function(n){C("__window__",{data:n}),O.broadcast(N("__window_ack__"),{id:g,origin:n.id,from:self.origin,primary:y})})),O.on(N("__message__"),(function(n){C("__message__",n),("primary"===n.target&&y||n.target===g)&&J(k.message,n)})),addEventListener("beforeunload",(function(){C("beforeunload"),O.emit(N("__close__"),{id:g,wasPrimary:y})}),{capture:!0}),function(){var n=Array.from(document.querySelectorAll("iframe"));return Promise.all(n.filter((function(n){return n.src})).map((function(n){return new Promise((function(e,t){n.addEventListener("load",e,!0),n.addEventListener("error",t,!0)}))}))).then(j(O.timeout))}().then((function(){setTimeout((function(){O.list().then((function(e){C("sysend.list()",e),x=e.length,y=0===e.length,(e.find((function(n){return n.primary}))||y)&&(n=!0),O.emit(N("__open__"),{id:g,primary:y}),y&&J(k.primary),function(n){var e=n||[];function t(){J(k.update,e)}t(),O.track("open",(function(n){n.id!==O.id&&(e.push(n),C({list:e,action:"open"}),t())}),!0),O.track("close",(function(n){C({list:e=e.filter((function(e){return n.id!==e.id})),action:"close"}),t()}),!0)}(e)}))}),0)})))}function K(){if(R(window.BroadcastChannel)){const n=document.requestStorageAccess&&"hasUnpartitionedCookieAccess"in document;return W()&&window.isSecureContext&&n?document.requestStorageAccess({all:!0}).then((function(n){t=n,C({init:n}),G()})).catch(G):G(),O}$&&M('Your browser don\'t support localStorgage. In Safari this is most of the time because of "Private Browsing Mode"'),G()}return-1!==["interactive","complete"].indexOf(document.readyState)?K():window.addEventListener("load",(function(){setTimeout(K,0)})),O}));

(function(n,o){typeof exports=="object"&&typeof module<"u"?module.exports=o():typeof define=="function"&&define.amd?define(o):(n=typeof globalThis<"u"?globalThis:n||self,n.EhMouseImagesTrail=o())})(this,function(){"use strict";class n{constructor(t){this.imageDOM=t,this.defaultStyles={x:0,y:0,opacity:0},this.size={width:0,height:0},this.init()}init(){this.updateSize()}updateSize(){const t=window.getComputedStyle(this.imageDOM);this.size.width=parseInt(t.width),this.size.height=parseInt(t.height)}onResize(){gsap.set(this.imageDOM,this.defaultStyles),this.updateSize()}isAnimating(){return gsap.isTweening(this.imageDOM)||this.imageDOM.style.opacity!=0}}const h={style1:(e,t,i,s)=>gsap.timeline({paused:!0}).set(e.imageDOM,{startAt:{opacity:0,scale:1},opacity:1,scale:1,zIndex:t,x:i.targetPosition.x-e.size.width/2,y:i.targetPosition.y-e.size.height/2},0).to(e.imageDOM,.9,{ease:Expo.easeOut,x:i.currentPosition.x-e.size.width/2,y:i.currentPosition.y-e.size.height/2},0).to(e.imageDOM,1,{ease:Power1.easeOut,opacity:0},.4).to(e.imageDOM,1,{ease:Quint.easeOut,scale:.2},.4),style2:(e,t,i,s)=>gsap.timeline({paused:!0}).set(e.imageDOM,{startAt:{opacity:0},opacity:1,scale:1,zIndex:t,x:i.targetPosition.x-e.size.width/2,y:i.targetPosition.y-e.size.height/2},0).to(e.imageDOM,1.8,{ease:Expo.easeOut,x:i.currentPosition.x-e.size.width/2,y:i.currentPosition.y-e.size.height/2},0).to(e.imageDOM,.8,{ease:Power1.easeOut,opacity:0},.8).to(e.imageDOM,.8,{ease:Quint.easeInOut,scale:2},.8),style3:(e,t,i,s)=>gsap.timeline({paused:!0}).set(e.imageDOM,{startAt:{opacity:0},opacity:1,zIndex:t,x:i.targetPosition.x-e.size.width/2,y:i.targetPosition.y-e.size.height/2},0).to(e.imageDOM,1.6,{ease:Expo.easeOut,x:i.currentPosition.x-e.size.width/2,y:i.currentPosition.y-e.size.height/2},0).to(e.imageDOM,1,{ease:Power1.easeOut,opacity:0},.4).to(e.imageDOM,1,{ease:Quint.easeInOut,y:`+=${s.height+e.size.height/2}`},.4),style4:(e,t,i,s)=>gsap.timeline({paused:!0}).set(e.imageDOM,{startAt:{opacity:0},opacity:1,rotation:0,zIndex:t,x:i.targetPosition.x-e.size.width/2,y:i.targetPosition.y-e.size.height/2},0).to(e.imageDOM,1.6,{ease:Expo.easeOut,x:i.currentPosition.x-e.size.width/2,y:i.currentPosition.y-e.size.height/2},0).to(e.imageDOM,.8,{ease:Power1.easeOut,opacity:0},.6).to(e.imageDOM,1,{ease:Quint.easeOut,x:`+=${window.ElementsHiveUtils.math.randomFloat(-1*(s.width+e.size.width/2),s.width+e.size.width/2)}`,y:`+=${window.ElementsHiveUtils.math.randomFloat(-1*(s.height+e.size.height/2),s.height+e.size.height/2)}`,rotation:window.ElementsHiveUtils.math.randomFloat(-40,40)},.6)};class r{constructor(t){this.container=t.container,this.eventsContainer=t.eventsContainer,this.imagesDOM=t.imagesDOM,this.imagesTotal=this.imagesDOM.length-1,this.trailStyle=t.trailStyle,this.isApplyToPage=t.isApplyToPage,this.isTouchDevice=window.ElementsHiveUtils.isTouchDevice(),this.nextImage={index:0,zIndex:1},this.mouseMoveThreshold=t.mouseMoveThreshold,this.containerBounds={top:0,left:0},this.viewport={width:window.innerWidth,height:window.innerHeight},this.updateContainerBounds(),this.mouse=window.ElementsHiveUtils.mouse,this.mousePositions={currentPosition:{x:0,y:0},targetPosition:{x:0,y:0},lastPosition:{x:0,y:0}},this.isApplyToPage?this.shouldRender=!0:this.shouldRender=!!window.ElementsHiveUtils.isElementInViewport(this.container),this.onEnterHandler=this.onMouseEnter.bind(this),this.onLeaveHandler=this.onMouseLeave.bind(this),this.onMoveHandler=this.onMouseMove.bind(this),this.onMovePageHandler=this.onMouseMovePage.bind(this),this.init()}init(){this.createImages(),this.initEvents(),requestAnimationFrame(this.render.bind(this))}createImages(){this.images=this.imagesDOM.map(t=>new n(t))}showNextImage(){const t=this.images[this.nextImage.index];(t.size.width===0||t.size.height===0)&&t.updateSize(),gsap.killTweensOf(t.imageDOM),h[this.trailStyle](t,this.nextImage.zIndex,this.mousePositions,this.viewport).play()}onMouseMove(){this.mousePositions.currentPosition.x=this.mouse.currentPosition.x-this.containerBounds.left,this.mousePositions.currentPosition.y=this.mouse.currentPosition.y-this.containerBounds.top}onMouseMovePage(){this.mousePositions.currentPosition.x=this.mouse.currentPosition.x,this.mousePositions.currentPosition.y=this.mouse.currentPosition.y}updateTargetPosition(){this.mousePositions.targetPosition.x=window.ElementsHiveUtils.math.lerp(this.mousePositions.targetPosition.x,this.mousePositions.currentPosition.x,.1),this.mousePositions.targetPosition.y=window.ElementsHiveUtils.math.lerp(this.mousePositions.targetPosition.y,this.mousePositions.currentPosition.y,.1)}getPositionDistance(){return window.ElementsHiveUtils.math.distance(this.mousePositions.currentPosition.x,this.mousePositions.currentPosition.y,this.mousePositions.lastPosition.x,this.mousePositions.lastPosition.y)}toggleShouldRender(){this.shouldRender=!this.shouldRender}onMouseEnter(){this.shouldRender||this.toggleShouldRender()}onMouseLeave(){this.shouldRender&&this.toggleShouldRender()}removeEvents(){console.log("image trail remove events"),this.isApplyToPage||(this.eventsContainer.removeEventListener("mouseenter",this.onEnterHandler),this.eventsContainer.removeEventListener("mouseleave",this.onLeaveHandler))}initEvents(){this.isApplyToPage?(this.isUsingMovePage=!0,this.mouse.on("move",this.onMovePageHandler)):(this.isUsingMovePage=!1,this.mouse.on("move",this.onMoveHandler)),this.isApplyToPage||(this.eventsContainer.addEventListener("mouseenter",this.onEnterHandler),this.eventsContainer.addEventListener("mouseleave",this.onLeaveHandler)),document.addEventListener("scroll",this.updateContainerBounds.bind(this)),window.addEventListener("resize",this.onResize.bind(this))}updateContainerBounds(){this.containerBounds=this.container.getBoundingClientRect()}onResize(){this.viewport={width:window.innerWidth,height:window.innerHeight},this.updateContainerBounds(),this.images.forEach(t=>{t.onResize()})}render(){if(requestAnimationFrame(this.render.bind(this)),!this.shouldRender)return;this.distance=this.getPositionDistance(),this.updateTargetPosition(),this.distance>this.mouseMoveThreshold&&(this.showNextImage(),this.nextImage.zIndex=this.nextImage.zIndex<this.imagesTotal+1?this.nextImage.zIndex+1:0,this.nextImage.index=this.nextImage.index<this.imagesTotal?this.nextImage.index+1:0,this.mousePositions.lastPosition={...this.mousePositions.currentPosition});let t=!0;for(let i of this.images)if(i.isAnimating()){t=!1;break}t&&this.nextImage.zIndex!==1&&(this.nextImage.zIndex=1)}}class l{constructor(t){this.options=t,this.images=[],this.init()}init(){this.cleanupMarkup(),this.createMarkup(),this.createInstance()}cleanupMarkup(){var t;(t=document.querySelector(`.${this.options.classWrapper}.${this.options.classInstanceID}`))==null||t.remove()}createMarkup(){const t=document.createElement("div");t.classList.add(this.options.classWrapper,this.options.classInstanceID),this.options.isApplyToPage?document.body.append(t):this.options.container.insertAdjacentElement("afterbegin",t),this.options.images.forEach(i=>{const s=document.createElement("img");s.src=i,t.append(s),this.images.push(s)})}createInstance(){this.instance=new r({container:this.options.container,eventsContainer:this.options.eventsContainer,trailStyle:this.options.trailStyle,imagesDOM:this.images,mouseMoveThreshold:this.options.mouseMoveThreshold,isApplyToPage:this.options.isApplyToPage})}destroy(){this.instance.removeEvents(),this.cleanupMarkup()}}return l});

(function(n,i){typeof exports=="object"&&typeof module<"u"?module.exports=i():typeof define=="function"&&define.amd?define(i):(n=typeof globalThis<"u"?globalThis:n||self,n.EhEntranceAnimationDisplacement=i())})(this,function(){"use strict";var k=Object.defineProperty;var v=(n,i,a)=>i in n?k(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a;var b=(n,i,a)=>(v(n,typeof i!="symbol"?i+"":i,a),a);gsap.registerPlugin(ScrollTrigger);const{getMediaQueryString:n,mergeObjects:i}=window.BreakdanceFrontend.utils;class a{constructor(t){b(this,"defaultOptions",{animation_type:null,duration:{number:1,unit:"s",style:"1s"},delay:{number:0,unit:"s",style:"0s"},distance:{number:30,unit:"px",style:"30px"},ease:"power1.out",trigger_location:0,play_once:!1,disable_at:null,enable_markers:!1});var e,s,r;this.options=i(this.defaultOptions,t),this.containerEl=t.containerEl,this.matchMedia=gsap.matchMedia(),this.breakpoints=window.BreakdanceFrontend.data.breakpoints,this.fadeInDuration=.4,this.fadeInEase="power2.out",this.fadeOutDuration=.4,this.fadeOutEase="power2.in",this.maxScale=this.getMaxScale(),this.isInsideTabs=!!((e=this.containerEl)!=null&&e.closest(".bde-advanced-tabs")),this.isInsideAccordion=!!((s=this.containerEl)!=null&&s.closest(".bde-accordion")),this.isAccordionWrapper=!!((r=this.containerEl)!=null&&r.classList.contains("bde-accordion__content-wrapper")),this.init()}init(){this.checkIfInAccordion(),this.createFilter(),this.createTimeline(),this.assignAnimationToElement(),this.initEvents()}checkIfInAccordion(){this.isInsideAccordion&&this.isAccordionWrapper&&(this.containerEl.style.opacity=1,this.containerEl.style.filter="none",this.containerEl=this.containerEl.querySelector(".bde-accordion__panel"),this.containerEl.style.opacity=0,this.containerEl.style.filter=`url(#eh-entrance-animation-displacement-${this.options.id})`,this.isInsideAccordion=!0)}getMaxScale(){switch(window.ElementsHiveUtils.browser.engine){case"blink":return"300";case"gecko":return"300";case"webkit":default:return"150"}}createCustomEvents(){this.animationStartedEvent=new CustomEvent("ehEntranceAnimationStarted",{detail:this.timeline,bubbles:!0,cancelable:!0,composed:!1}),this.animationCompletedEvent=new CustomEvent("ehEntranceAnimationCompleted",{detail:this.timeline,bubbles:!0,cancelable:!0,composed:!1})}getFilterStyle(){const{displacement_style:t}=this.options,e={baseFrequency:"0.005",numOctaves:"1",noiseType:"fractalNoise"};switch(t){case"style_1":default:e.baseFrequency="0.005";break;case"style_2":e.baseFrequency="0.015";break;case"style_3":e.baseFrequency="0.03";break;case"style_4":e.baseFrequency="0.05";break;case"style_5":e.baseFrequency="0.1";break;case"style_6":e.baseFrequency="0.2";break;case"style_7":e.baseFrequency="0.005 0.03";break;case"style_8":e.baseFrequency="0.005 0.06";break;case"style_9":e.baseFrequency="0.005 0.1";break;case"style_10":e.baseFrequency="0.005 0.15";break;case"style_11":e.baseFrequency="0.005 0.2";break;case"style_12":e.baseFrequency="0.05 0.2";break;case"style_13":e.baseFrequency="0.05 0.4";break;case"style_14":e.baseFrequency="0.03 0.005";break;case"style_15":e.baseFrequency="0.06 0.005";break;case"style_16":e.baseFrequency="0.1 0.005";break;case"style_17":e.baseFrequency="0.15 0.005";break;case"style_18":e.baseFrequency="0.2 0.005";break}return e}createFilter(){const{id:t}=this.options;if(this.displacementMap=this.containerEl.querySelector(`#eh-entrance-animation-displacement-${t} feDisplacementMap`),this.displacementMap)return;const e=this.getFilterStyle();this.filterCode=`
		<svg color-interpolation-filters="sRGB" style="width: 0; height: 0;">
			<defs>
			<filter id="eh-entrance-animation-displacement-${t}">
				<feTurbulence baseFrequency="${e.baseFrequency}" numOctaves="${e.numOctaves}" result="warp" type="${e.noiseType}"></feTurbulence>
				<feDisplacementMap in="SourceGraphic" in2="warp" scale="0" xChannelSelector="R" yChannelSelector="B"></feDisplacementMap>
			</filter>
			</defs>
		</svg>
		`,this.filterWrapper=document.createElement("div"),this.filterWrapper.style.width=0,this.filterWrapper.style.height=0,this.filterWrapper.innerHTML=this.filterCode,this.containerEl.append(this.filterWrapper),this.displacementMap=this.containerEl.querySelector(`#eh-entrance-animation-displacement-${t} feDisplacementMap`)}assignAnimationToElement(){this.containerEl._elementsHive||(this.containerEl._elementsHive={}),this.containerEl._elementsHive.entranceAnimation||(this.containerEl._elementsHive.entranceAnimation={}),this.containerEl._elementsHive.entranceAnimation.timeline=this.timeline,this.containerEl._elementsHive.entranceAnimation.reset=()=>this.resetTimelineProps(),this.containerEl._elementsHive.entranceAnimation.play=()=>this.timeline.restart(),this.containerEl._elementsHive.entranceAnimation.fadeIn=()=>this.fadeIn(),this.containerEl._elementsHive.entranceAnimation.fadeOut=()=>this.fadeOut()}fadeIn(){gsap.fromTo(this.containerEl,{opacity:0},{opacity:1,duration:this.fadeInDuration,ease:this.fadeInEase})}fadeOut(){gsap.fromTo(this.containerEl,{opacity:1},{opacity:0,duration:this.fadeOutDuration,ease:this.fadeOutEase})}resetTimelineProps(){gsap.set(this.containerEl,{opacity:0}),gsap.set(this.displacementMap,{attr:{scale:this.maxScale}})}getElementFromConfig(){const{direction:t,distance:e}=this.options,s={opacity:0};return t==="right"||t==="left"?s.x=t==="right"?`-${e.number}`:e.number:(t==="up"||t==="down")&&(s.y=t==="up"?e.number:`-${e.number}`),s}getElementToConfig(){const{direction:t}=this.options,e={opacity:1};return t==="right"||t==="left"?e.x=0:(t==="up"||t==="down")&&(e.y=0),e}createTimeline(){var u;const{duration:t,delay:e,ease:s,trigger_location:r,play_once:l,disable_at:c,distance:m,direction:p,id:y,enable_markers:E}=this.options;window.ElementsHiveUtils.browser==="safari"&&e.number===0&&(e.number=.1);const g=this.getElementFromConfig(),_=this.getElementToConfig();let o="top";if(p==="up"?o=`top-=${m.style}`:p==="down"&&(o=`top+=${m.style}`),this.matchMedia.add({allMediaQueries:"all",isReduceMotion:"(prefers-reduced-motion: reduce)"},d=>{let{isReduceMotion:f}=d.conditions;this.timeline=gsap.timeline({delay:e.number,paused:!0,scrollTrigger:{trigger:this.containerEl,start:`${o} ${100-r}%`,toggleActions:"play none none none",id:y,markers:E,onRefresh:F=>{},onEnter:()=>{this.containerEl.dataset.ehIsAnimated==="false"&&this.timeline.restart(!0)},onLeave:()=>{this.containerEl.dataset.ehIsAnimated||this.timeline.progress(1)}},onStart:()=>{this.containerEl.dispatchEvent(this.animationStartedEvent)},onComplete:()=>{this.containerEl.dataset.ehIsAnimated=!0,this.containerEl.dispatchEvent(this.animationCompletedEvent)}}).fromTo(this.containerEl,{...g},{..._,duration:f?0:t.number/3,ease:"power4.out"},0).fromTo(this.displacementMap,{attr:{scale:this.maxScale}},{duration:f?0:t.number,ease:s,attr:{scale:"0"}},0),this.createCustomEvents(),l||ScrollTrigger.create({trigger:this.containerEl,start:`${o} bottom`,onLeaveBack:()=>{gsap.set(this.containerEl,{opacity:0}),gsap.set(this.displacementMap,{attr:{scale:this.maxScale}}),this.containerEl.dataset.ehIsAnimated=!1}})}),!c)return;let h=n("",(u=this.breakpoints.filter(d=>d.id===c)[0])==null?void 0:u.maxWidth);!h&&c==="breakpoint_base"&&(h="all"),this.matchMedia.add(h,()=>{gsap.set(this.containerEl,{opacity:1}),gsap.set(this.displacementMap,{attr:{scale:"0"}})})}initEvents(){this.isInsideTabs&&window.addEventListener("breakdance_refresh_animations",()=>{this.containerEl.dataset.ehIsAnimated=!1,this.timeline.restart()}),this.isInsideAccordion&&this.containerEl.closest(".bde-accordion__content-wrapper").querySelector(".bde-accordion__button").addEventListener("click",()=>{this.containerEl.dataset.ehIsAnimated=!1,this.timeline.restart()})}deleteMarkers(){["start","end","scroller-start","scroller-end"].forEach(e=>{const s=`.gsap-marker-${e}.marker-${this.options.id}`;document.querySelectorAll(s).forEach(l=>l.remove())})}destroy(){this.deleteMarkers(),this.matchMedia.contexts.forEach(t=>{t.data.forEach(e=>{e==null||e.kill(),e=null}),t=null}),this.matchMedia.revert(),this.matchMedia=null,gsap.set(this.containerEl,{clearProps:"all"}),this.filterWrapper.remove()}}return a});

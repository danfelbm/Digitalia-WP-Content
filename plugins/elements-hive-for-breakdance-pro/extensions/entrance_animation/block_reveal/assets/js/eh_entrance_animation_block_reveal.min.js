(function(r,s){typeof exports=="object"&&typeof module<"u"?module.exports=s():typeof define=="function"&&define.amd?define(s):(r=typeof globalThis<"u"?globalThis:r||self,r.EhEntranceAnimationBlockReveal=s())})(this,function(){"use strict";var O=Object.defineProperty;var A=(r,s,a)=>s in r?O(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a;var y=(r,s,a)=>(A(r,typeof s!="symbol"?s+"":s,a),a);gsap.registerPlugin(ScrollTrigger);const{getMediaQueryString:r,mergeObjects:s}=window.BreakdanceFrontend.utils;class a{constructor(e){y(this,"defaultOptions",{animation_type:null,direction:"right",duration:{number:1,unit:"s",style:"1s"},delay:{number:0,unit:"s",style:"0s"},layers_delay:{number:.1,unit:"s",style:"0.1s"},ease:"power1.out",trigger_location:0,once:!1,disable_at:null,enable_markers:!1});var t;this.options=s(this.defaultOptions,e),this.containerEl=e.containerEl,this.matchMedia=gsap.matchMedia(),this.breakpoints=window.BreakdanceFrontend.data.breakpoints,this.transformStyles=this.getTranformStyles(e.direction),this.fadeInDuration=.4,this.fadeInEase="power2.out",this.fadeOutDuration=.4,this.fadeOutEase="power2.out",this.isInsideTabs=!!((t=this.containerEl)!=null&&t.closest(".bde-advanced-tabs")),this.init()}init(){this.createMarkup(),this.createTimeline(),this.assignAnimationToElement(),this.initEvents(),this.isInited=!0}createMarkup(){const{block_layers:e,id:t}=this.options;this.blockLayers=[],this.revealWrapper=document.createElement("div"),this.revealWrapper.classList.add("eh-entrance-animation-block-reveal__wrapper"),this.revealWrapper.dataset.nodeId=t,this.updateWrapperStyles(),this.containerEl.parentElement.insertBefore(this.revealWrapper,this.containerEl),this.revealWrapper.appendChild(this.containerEl),e.forEach(i=>{const n=document.createElement("div");n.classList.add("eh-entrance-animation-block-reveal__layer"),i.type=="solid"?n.style.backgroundColor=i.color||"#404040":n.style.backgroundImage=i.color,n.style.transform=this.transformStyles.transform,n.style.transformOrigin=this.transformStyles.origin.start,this.revealWrapper.append(n),this.blockLayers.push(n)})}updateWrapperStyles(){const e=window.getComputedStyle(this.containerEl);e.position==="absolute"&&(this.revealWrapper.style.position=e.position,this.revealWrapper.style.top=e.top,this.revealWrapper.style.left=e.left,this.revealWrapper.style.right=e.right,this.revealWrapper.style.bottom=e.bottom),this.revealWrapper.style.width=e.width,this.revealWrapper.style.maxWidth=e.maxWidth}assignAnimationToElement(){this.containerEl._elementsHive||(this.containerEl._elementsHive={}),this.containerEl._elementsHive.entranceAnimation||(this.containerEl._elementsHive.entranceAnimation={}),this.containerEl._elementsHive.entranceAnimation.timeline=this.timeline,this.containerEl._elementsHive.entranceAnimation.reset=()=>this.resetTimelineProps(),this.containerEl._elementsHive.entranceAnimation.play=()=>this.timeline.restart(),this.containerEl._elementsHive.entranceAnimation.fadeIn=()=>this.fadeIn(),this.containerEl._elementsHive.entranceAnimation.fadeOut=()=>this.fadeOut()}fadeIn(){gsap.fromTo(this.containerEl,{opacity:0},{opacity:1,duration:this.fadeInDuration,ease:this.fadeInEase})}fadeOut(){gsap.fromTo(this.containerEl,{opacity:1},{opacity:0,duration:this.fadeOutDuration,ease:this.fadeOutEase})}resetTimelineProps(){gsap.set(this.containerEl,{opacity:0})}setBlockLayersTransformState(e,t=!0){this.blockLayers.forEach(i=>{t&&(i.style.transform=this.transformStyles.transform),i.style.transformOrigin=e==="start"?this.transformStyles.origin.start:this.transformStyles.origin.end})}getTranformStyles(e){let t,i,n=null;switch(e){case"right":default:t="scale3d(0,1,1)",i="0 50%",n="100% 50%";break;case"left":t="scale3d(0,1,1)",i="100% 50%",n="0 50%";break;case"down":t="scale3d(1,0,1)",i="50% 0",n="50% 100%";break;case"up":t="scale3d(1,0,1)",i="50% 100%",n="50% 0";break}return{transform:t,origin:{start:i,end:n}}}getElementFromConfig(){return{opacity:0}}getElementToConfig(){return{opacity:1}}getBlocksFromConfig(){const{direction:e}=this.options,t={};return e==="left"||e==="right"?t.scaleX=0:t.scaleY=0,t}getBlocksToConfig(){const{direction:e}=this.options,t={};return e==="left"||e==="right"?t.scaleX=1:t.scaleY=1,t}createCustomEvents(){this.animationStartedEvent=new CustomEvent("ehEntranceAnimationStarted",{detail:this.timeline,bubbles:!0,cancelable:!0,composed:!1}),this.animationCompletedEvent=new CustomEvent("ehEntranceAnimationCompleted",{detail:this.timeline,bubbles:!0,cancelable:!0,composed:!1})}createTimeline(){var E;const{duration:e,delay:t,ease:i,trigger_location:n,play_once:o,disable_at:c,layers_delay:u,id:v,enable_markers:b,block_reveal_style:k}=this.options,T=this.getElementFromConfig(),C=this.getElementToConfig(),g=this.getBlocksFromConfig(),_=this.getBlocksToConfig(),h=e.number/2,S=this.blockLayers.length;if(this.matchMedia.add({allMediaQueries:"all",isReduceMotion:"(prefers-reduced-motion: reduce)"},d=>{let{isReduceMotion:p}=d.conditions;this.timeline=gsap.timeline({delay:t.number,paused:!0,scrollTrigger:{trigger:this.containerEl,start:`top ${100-n}%`,toggleActions:"play none none none",id:v,markers:b,onEnter:()=>{this.containerEl.dataset.ehIsAnimated==="false"&&this.timeline.restart(!0)},onLeave:()=>{this.containerEl.dataset.ehIsAnimated||this.timeline.progress(1)}},onStart:()=>{this.containerEl.dispatchEvent(this.animationStartedEvent)},onComplete:()=>{this.containerEl.dataset.ehIsAnimated=!0,this.containerEl.dispatchEvent(this.animationCompletedEvent)}}),this.createCustomEvents(),this.blockLayers.forEach((l,f)=>{const W=f===0?0:u.number*f;this.timeline.fromTo(l,{...g},{duration:p?0:h,delay:W,ease:i,..._,onStart:()=>{l.style.transformOrigin=this.transformStyles.origin.start},onComplete:()=>{l.style.transformOrigin=this.transformStyles.origin.end,gsap.to(l,{duration:p?0:h,delay:function(){return k==="style_1"?0:u.number*2*(S-1-f)},ease:i,...g})}},0)}),this.timeline.fromTo(this.containerEl,{...T},{...C,duration:p?0:h,ease:"power4.out",clearProps:"all"}),o||ScrollTrigger.create({trigger:this.containerEl,start:"top bottom",onLeaveBack:()=>{this.timeline.progress(1),gsap.set(this.containerEl,{opacity:0}),this.setBlockLayersTransformState("start"),this.containerEl.dataset.ehIsAnimated=!1}})}),!c)return;let m=r("",(E=this.breakpoints.filter(d=>d.id===c)[0])==null?void 0:E.maxWidth);!m&&c==="breakpoint_base"&&(m="all"),this.matchMedia.add(m,()=>{gsap.set(this.containerEl,{opacity:1}),this.setBlockLayersTransformState("end")})}createContainerObserver(){this.containerObserver=new ResizeObserver(()=>{this.resetOnResize()}),this.containerObserver.observe(this.revealWrapper.parentElement)}initEvents(){this.createContainerObserver(),this.isInsideTabs&&window.addEventListener("breakdance_refresh_animations",()=>{this.containerEl.dataset.ehIsAnimated=!1,this.timeline.restart()})}resetOnResize(){var e;this.revealWrapper.parentElement.insertBefore(this.containerEl,this.revealWrapper),this.revealWrapper.remove(),this.createMarkup(),(e=this.timeline)==null||e.kill(),this.matchMedia=null,this.matchMedia=gsap.matchMedia(),this.createTimeline(),this.assignAnimationToElement()}deleteMarkers(){["start","end","scroller-start","scroller-end"].forEach(t=>{const i=`.gsap-marker-${t}.marker-${this.options.id}`;document.querySelectorAll(i).forEach(o=>o==null?void 0:o.remove())})}destroy(){var e,t;this.deleteMarkers(),this.matchMedia.revert(),(e=this.timeline)==null||e.kill(),this.matchMedia=null,gsap.set(this.containerEl,{clearProps:"all"}),(t=this.containerObserver)==null||t.disconnect(this.revealWrapper.parentElement),this.revealWrapper.parentElement.insertBefore(this.containerEl,this.revealWrapper),this.revealWrapper.remove()}}return a});
